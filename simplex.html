<html>
    <head>
        <title>Simplex method</title>
    </head>
    <body>
        <script>
        	(function() {
                window.onload = function() {
                    var input = { 
                        goalFunction: { 
                            variables : [2, 3, -1, 5, 0],
                            freeMember : 0,
                            isMinimum : true
                        }, 
                        restrictions: [{
                            number: 3,
                            variables: [
                                {
                                    value: -2,
                                    isBasis: false
                                }, {
                                    value: -1,
                                    isBasis: false
                                }, {
                                    value: 1,
                                    isBasis: true
                                }, {
                                    value: 0,
                                    isBasis: false
                                }, {
                                    value: 0,
                                    isBasis: false
                                }
                            ],
                            freeMember: 2
                        },
                         {
                            number: 4,
                            variables: [
                                {
                                    value: 4,
                                    isBasis: false
                                }, {
                                    value: 3,
                                    isBasis: false
                                }, {
                                    value: 0,
                                    isBasis: false
                                }, {
                                    value: 1,
                                    isBasis: true
                                }, {
                                    value: 0,
                                    isBasis: false
                                }
                            ],
                            freeMember: 4
                        },
                         {
                            number: 5,
                            variables: [
                                {
                                    value: -3,
                                    isBasis: false
                                }, {
                                    value: -1,
                                    isBasis: false
                                }, {
                                    value: 0,
                                    isBasis: false
                                }, {
                                    value: 0,
                                    isBasis: false
                                }, {
                                    value: 1,
                                    isBasis: true
                                }
                            ],
                            freeMember: 4
                        }]
                    };

                    function GoalFunction(equation, isMinimum) {
                        this.equation = equation;
                        this.isMinimum = isMinimum;
                    }

                    function Mark(number, value) {
                        this.number = number;
                        this.value = value;                
                    }

                    function SimplexTable(restrictedEquations) {
                        this.restrictedEquations = restrictedEquations;
                        this.marks = [];
                        this.maxMark = null;
                        this.minRelation = null;
                        this.goalFunctionValue = null;
                    }

                    SimplexTable.prototype.evaluateMaxMark = function() {
                        var currentMark, maxMark, j;
                        j = 0;
                        maxMark = { number: null, value: -1 };
                        
                        while (currentMark = this.marks[j++]) {
                             if (currentMark.value > maxMark.value) {
                                 maxMark = currentMark;                
                             }           
                        }
                                  
                        this.maxMark = maxMark;                
                    }

                    SimplexTable.prototype.evaluateMinRelation = function() {
                        var currentEquation, minRelation, minRelationVal, relationVal, j;
                        j = 0;
                        minRelationVal = Number.MAX_SAFE_INTEGER; 

                        while (currentEquation = this.restrictedEquations[j++]) {
                              relationVal = currentEquation.freeMember / currentEquation.variables[this.maxMark.number - 1].coeficientValue;
                                          
                              if (relationVal >= 0 && relationVal < minRelationVal) {
                                   minRelation = currentEquation;
                                   minRelationVal = relationVal;              
                              }          
                        }

                        this.minRelation = minRelation;
                    }

                    function FirstSimplexTable(restrictedEquations, goalFunctionCoef) {
                        SimplexTable.call(this, restrictedEquations);
                        this.goalFunctionCoef = goalFunctionCoef;
                    }
                    FirstSimplexTable.prototype = Object.create(SimplexTable.prototype);

                    FirstSimplexTable.prototype.evaluateMarks = function() {
                         var currentEquation, j, i, mark;

                         for (i = 0; i < this.goalFunctionCoef.length; i++) {
                             mark = 0; 
                                            
                             for (j = 0; currentEquation = this.restrictedEquations[j++];) {
                                 mark += (currentEquation.variables[i].coeficientValue * this.goalFunctionCoef[currentEquation.numberBasis - 1].coeficientValue);
                             }

                             mark -= this.goalFunctionCoef[i].coeficientValue;

                             this.marks.push(new Mark(i + 1, mark));       
                         }
                    }

                    FirstSimplexTable.prototype.evaluateFunctionGoalValue = function() {
                          var i, currentElement, value = 0;

                          i = 0;
                          while (currentElement = this.restrictedEquations[i++]) {
                                value += this.goalFunctionCoef[currentElement.numberBasis - 1].coeficientValue * currentElement.freeMember;               
                          }

                          this.goalFunctionValue = value;            
                    }

                    FirstSimplexTable.prototype.evaluate = function() {
                        this.evaluateMarks();
                        this.evaluateFunctionGoalValue();
                        this.evaluateMaxMark();
                        this.evaluateMinRelation();               
                    }

                    function Variable(number, coeficientValue) {
                        this.number = number;
                        this.coeficientValue = coeficientValue || 0;
                    }

                    function RestritedVariable(number, coeficientValue, isBasis) {
                        Variable.call(this, number, coeficientValue);
                        this.isBasis = isBasis || false;
                    }
                    RestritedVariable.prototype = Object.create(Variable.prototype);

                    function Equation(variables, freeMember) {
                        this.variables = variables;
                        this.freeMember = freeMember;
                    }

                    function RestritedEquation(numberBasis, variables, freeMember) {
                        Equation.call(this, variables, freeMember);
                        this.numberBasis = numberBasis;
                    }
                    RestritedEquation.prototype = Object.create(Equation.prototype);


                    (function start() {
                        var goalFunction, simplexTables, currentSimplexTable;
                        simplexTables = [];
                                        
                        function constructGoalFunction() {
                            var variables, freeMember;
                            var goalFunction, currentElement, currentVariable;
                            variables = [];
                            
                            currentElement = input.goalFunction;
 
                            if (!currentElement) {
                                return goalFunction;
                            }

                            for (j = 0; (currentVariable = currentElement.variables[j++]) !== undefined;) {
                                variables.push(new Variable(j,
                                     currentElement.isMinimum ? currentVariable : - currentVariable));
                            }

                            currentElement.freeMember = currentElement.isMinimum ? currentElement.freeMember : -currentElement.freeMember;

                            return goalFunction = new GoalFunction(
                                 new Equation(variables, currentElement.freeMember),
                                 true
                            ); 
                        }

                        function constructFirstSimplexTable(goalFunction) {
                            var restrictions, restrictedEquations, variables,
                                currentElement, currentVariable, j, k;

                            restrictions = input.restrictions;
                            restrictedEquations = [];

                            if (restrictions)

                            for (j = 0; currentElement = restrictions[j++];) {
                                variables = [];

                                for (k = 0; currentVariable = currentElement.variables[k++];) {
                                    variables.push(
                                        new RestritedVariable(k, currentVariable.value, currentVariable.isBasis)
                                    );
                                }

                                restrictedEquations.push(
                                    new RestritedEquation(currentElement.number, variables, currentElement.freeMember)
                                );
                            }
                            
                            return new FirstSimplexTable(restrictedEquations, goalFunction.equation.variables);
                        }

                        function constructSimplexTable(previousSimplexTable) {
                            var newSimplexTable;          
                                        
                            debugger;            
                        }

                        goalFunction = constructGoalFunction();

                        currentSimplexTable = constructFirstSimplexTable(goalFunction);
                        simplexTables.push(currentSimplexTable);
                        currentSimplexTable.evaluate();

                        currentSimplexTable = constructSimplexTable(currentSimplexTable);

                        console.log(goalFunction);
                        console.log(simplexTables);
                        
                    })();
                }
            })();
        </script>
    </body>
</html>
    